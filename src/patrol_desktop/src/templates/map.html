<!DOCTYPE html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <script>
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>

    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <style>
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            left: 0;
        }
    </style>
    <script src="../static/leaflet.js"></script>
    <script src="../static/jquery-1.12.4.min.js"></script>
    <script src="../static/bootstrap.min.js"></script>
    <script src="../static/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="../static/leaflet.css" />
    <link rel="stylesheet" href="../static/bootstrap.min.css" />
    <link rel="stylesheet" href="../static/bootstrap-theme.min.css" />
    <link rel="stylesheet" href="../static/font-awesome.min.css" />
    <link rel="stylesheet" href="../static/leaflet.awesome-markers.css" />
    <link rel="stylesheet" href="../static/leaflet.awesome.rotate.min.css" />

    <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
        #map_21f79ff9743d46379a4565c8a15583ed {
            position: relative;
            width: 100.0%;
            height: 100.0%;
            left: 0.0%;
            top: 0.0%;
        }
    </style>

    <script src="../static/Control.FullScreen.min.js"></script>
    <link rel="stylesheet" href="../static/Control.FullScreen.min.css" />
    <script src="../static/leaflet-measure.min.js"></script>
    <link rel="stylesheet" href="../static/leaflet-measure.min.css" />
    <script src="../static/leaflet.draw.js"></script>
    <link rel="stylesheet" href="../static/leaflet.draw.css" />
    <script src="../static/leaflet-realtime.js"></script>
    <script src="../static/leaflet-gps/src/leaflet-gps.js"></script>
    <link rel="stylesheet" href="../static/leaflet-gps/src/leaflet-gps.css" />
    <script src="../static/leaflet-liveupdate.js"></script>
    <link rel="stylesheet" href="../static/leaflet-liveupdate.css">
    <script src="../static/leaflet-icon-pulse/dist/L.Icon.Pulse.js"></script>
    <link rel="stylesheet" href="../static/leaflet-icon-pulse/dist/L.Icon.Pulse.css" />
</head>

<body>
    <div class="folium-map" id="map_21f79ff9743d46379a4565c8a15583ed"></div>
</body>

<script>
    var map_21f79ff9743d46379a4565c8a15583ed = L.map(
        "map_21f79ff9743d46379a4565c8a15583ed", {
            center: [0, 0],
            crs: L.CRS.EPSG3857,
            zoom: 15,
            zoomControl: true,
            preferCanvas: false,
            googleMap: "SATELLITE",
            widescreen: true,
            latlonControl: false,
            drawControl: false,
            drawExport: false,
            layersControl: true,
        }
    );
    L.control.scale().addTo(map_21f79ff9743d46379a4565c8a15583ed);
    var pulsingIcon = L.icon.pulse({
        iconSize: [10, 10],
        color: 'yellow',
        fillColor: "red",
        animate: true
    });

    var robo_marker = L.marker([0, 0], {
        icon: pulsingIcon
    }).addTo(map_21f79ff9743d46379a4565c8a15583ed)

    function handle(name) {
        $.post(name, function(params) {
            params = JSON.stringify(params)
            data = JSON.parse(params)

            // console.log(params)
            // console.log(typeof(params))
            // console.log(data.lat, data.lon)
            pos = L.latLng(data.lat, data.lon)
            robo_marker.setLatLng(pos)
        });
    }
    L.control.liveupdate({
            update_map: function() {
                // var pos = L.latLng()
                handle("/location_cb")
            },
            position: 'topleft',
            interval: 200
        })
        .addTo(map_21f79ff9743d46379a4565c8a15583ed)
        .startUpdating();

    var tile_layer_3104e394f966476c9cb764bdb9214179 = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            "attribution": "Data by \u0026copy; \u003ca href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.",
            "detectRetina": false,
            "maxNativeZoom": 18,
            "maxZoom": 18,
            "minZoom": 0,
            "noWrap": false,
            "opacity": 1,
            "subdomains": "abc",
            "tms": false
        }
    ).addTo(map_21f79ff9743d46379a4565c8a15583ed);


    L.control.fullscreen({
        "forceSeparateButton": false,
        "position": "topleft",
        "title": "Full Screen",
        "titleCancel": "Exit Full Screen"
    }).addTo(map_21f79ff9743d46379a4565c8a15583ed);


    var measure_control_a53b2d51fc0c4d799fea9110e91a8106 = new L.Control.Measure({
        "position": "bottomleft",
        "primaryAreaUnit": "sqmeters",
        "primaryLengthUnit": "meters",
        "secondaryAreaUnit": "acres",
        "secondaryLengthUnit": "miles"
    });
    map_21f79ff9743d46379a4565c8a15583ed.addControl(measure_control_a53b2d51fc0c4d799fea9110e91a8106);



    var tile_layer_704c24a7f6564f87af95c6da273c80fc = L.tileLayer(
        "https://mt1.google.com/vt/lyrs=s\u0026x={x}\u0026y={y}\u0026z={z}", {
            "attribution": "Google",
            "detectRetina": false,
            "maxNativeZoom": 18,
            "maxZoom": 18,
            "minZoom": 0,
            "noWrap": false,
            "opacity": 1,
            "subdomains": "abc",
            "tms": false
        }
    ).addTo(map_21f79ff9743d46379a4565c8a15583ed);


    map_21f79ff9743d46379a4565c8a15583ed.fitBounds(
        [
            [56.149568, 40.376083],
            [56.149568, 40.376083]
        ], {
            "maxZoom": 15
        }
    );


    var options = {
            position: "topleft",
            draw: {},
            edit: {},
        }
        // FeatureGroup is to store editable layers.
    var drawnItems = new L.featureGroup().addTo(
        map_21f79ff9743d46379a4565c8a15583ed
    );
    options.edit.featureGroup = drawnItems;
    var draw_control_25b3f6ec66f845c3a5abacd0af60a859 = new L.Control.Draw(
        options
    ).addTo(map_21f79ff9743d46379a4565c8a15583ed);
    map_21f79ff9743d46379a4565c8a15583ed.on(L.Draw.Event.CREATED, function(e) {
        var layer = e.layer,
            type = e.layerType;
        var coords = JSON.stringify(layer.toGeoJSON());
        localStorage.setItem("drawn", coords);
        layer.on('click', function() {
            drawnItems.addLayer(layer);
            var data = drawnItems.toGeoJSON();
            console.log(coords);
        });

    });
    map_21f79ff9743d46379a4565c8a15583ed.on('draw:created', function(e) {
        drawnItems.addLayer(e.layer);
    });




    var layer_control_fa6cb8cda21b44de99312bfd0157e7d9 = {
        base_layers: {
            "openstreetmap": tile_layer_3104e394f966476c9cb764bdb9214179,
        },
        overlays: {
            "Google Satellite": tile_layer_704c24a7f6564f87af95c6da273c80fc,
        },
    };
    L.control.layers(
        layer_control_fa6cb8cda21b44de99312bfd0157e7d9.base_layers,
        layer_control_fa6cb8cda21b44de99312bfd0157e7d9.overlays, {
            "autoZIndex": true,
            "collapsed": true,
            "position": "topright"
        }
    ).addTo(map_21f79ff9743d46379a4565c8a15583ed);
</script>